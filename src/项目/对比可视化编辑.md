# 一、腾讯IMWeb 积木

系统的核心功能
分析了各方的痛点以及诉求之后，系统的核心功能其实很容易理出来：

简单易用的、可视化的可编辑页面
通用的、简便地组件接入机制
当然除此之外还要有：

- 发布系统，既然是批量的生成页面，也就没必要每次都有测试（首次发布要严格测试）来发布
- 编译系统，类似 grunt ，fis 做的事，发布之前要编译，如果资源合并、CDN 路径替换等等
- 业务管理系统，是的，这个系统不能只为腾讯课堂服务
- 权限系统，不多说
- 响应式，一次配置，多端运行

## 可视化和组件化摆到了核心位置：系统本身和组件体系。

- 系统：
	- 可视化编辑
	- 发布
	- 接入各种组件
- 组件：
	- 开发过程和系统无关
	- 逻辑和系统无关
	- 遵照系统约定

## 2.0 的新特性包括但不限于以下几点：

- 系统和业务分离，业务逻辑以插件的形式接入系统，方便业务接入。
- 组件开发套件，无需搭建系统来 debug 组件。
- 更多的表单类型支持，这里的表单是编辑页产品配置表单，包括单选、多选等等常用表单，颜色选择器优化以及能展现复杂数据结构的组件 型表单。
- 更易定制的、易于业务优化的编译、打包系统。

# 二、腾讯AlloyTeam可视化编辑框架Pipeline
## 页面组件化
可视化搭建可以转化为 2 个较简单的操作:

组件树组合, 页面可视化搭建变成页面组件的可视化组合.
组件配置编辑, 将对页面内容的编辑转化为对组件的配置属性 (props) 修改.

技术难点 1: 页面可视化搭建工具与页面前端框架解偶.

不同框架写出来的组件（vue、react）都能在可视化搭建工具的系统中复用

## 页面模板
模板带有页面的默认数据; 对于组件化的页面, 模板是从组件库中选取部分组件, 并带有各个组件的默认配置数据.

## 页面编辑
包括2个部分

- 编辑页面组件：动态添加、删除组件
	- 直接渲染
	- 重新打包 
- 编辑页面内容：对组件属性props进行配置 
	- 组件配置数据
	- 组件差异化
	- 组件配置表单：技术难点2，如何用最简单的方式生成配置数据编辑表单

## 组件层级关系
- 数据流：
	- 父子组件通过数据流和事件进行关联
- 层级对数据流和布局的影响

## 页面预览
- 前端挂载
	- 实时渲染速度快.
	- 编辑器的技术选型需和组件库前端框架一致.
	- 编辑器源码和组件库源码耦合？(atom好像不会
	- 组件库组件渲染后的代码逻辑和样式布局, 可能会污染编辑器页面.（atom做好了样式隔离，好像也不会
- 后端渲染
	- 可以实现编辑器和组件库前端框架的分离.
	- 可以实现编辑器和组件库各组件的分离.
	- 可以避免预览页面的逻辑和样式污染编辑器环境.
	- 要求后台和组件库提供页面后台渲染能力, 并要求后台渲染速度快, 用户需要" 实时" 预览.

## 页面构建
生成页面资源的必要环节: 

- 开发时需要进行开发构建来进行页面调试; 
- 在可视化编辑后可能需要重新构建来生成预览页面; 
- 在发布前需要进行生产构建.


## 总结：
- 采用组件化和页面模板实现页面生成效率的提升.
- 采用不嵌套的组件层级简化数据流和样式布局.
- 采用 JSON Schema 声明配置数据, 自动生成配置表单.
	-  按照 JSON Schema 规范对 JSON 数据进行描述, 可以动态渲染出配置表单; 且 JSON Schema 可以对编辑后的数据做格式校验, 避免编辑错误. 
- 采用后台渲染, 使编辑系统与组件前端框架解耦.
- 在遵循编辑系统约定下, 组件可以自由拓展, 前端框架可以自由选择.


# 三、美团的乐高
## 总体概览
- 组件树
- 预览页面
- 属性编辑
- 页面操作：重命名、发布
- 左侧导航：组装工厂、开发工厂、运营数据等实时监控
## 自定义数据源
## 组件
- 接口暴露
	- render： 返回一段html 字符串
	- name：在系统中的引用，全局唯一
	- leaf：
		- 1.如果可包含子节点，请在数组中添加组件id，如: exports.leaf = [12,23,34]
		- 2.如果不可包含任何子节点，请将leaf置为null，即: exports.leaf = null
		- 3.如果可包含任何子节点，请将leaf置为空数组，即: exports.leaf = []
	- uilib：需要适配的组件库
	- model：属性面板配置
		- 属性名
		- 属性对应的ui控件类型：textarea、radio、select  
	- script：组件的自定义逻辑和与外界的交互，会作为script脚本插入到html中
		- function (mvid, evtMgr, modelData) 
		- 入参是组件id，全局的事件系统（bind、trigger），组件
- 组件渲染
	- 使用了freemarker.js模板引擎
	- 输入为在乐高工厂中形成的页面描述的数据结构，逐步添加外部资源（数据源、界面资源库、模块）进行组合， 
- 组件通信
	- 全局事件系统 
- 版本控制
	- 每个组件预留了开发者版本。
	- 开发完毕后，需要单独的发布该组件。
	- 在视图中进行组装时，可以选择所需要的版本，
	- 如果新版本有问题，能够及时做到单独模块的线上回滚。
- 数据交付

## 数据结构
- 一个扁平的页面数据结构
- children来存储子节点的id，并不完全存储子节点的大对象





